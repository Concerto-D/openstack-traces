<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-02-24 lun. 14:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reproducibility guide for Madeus Openstack Use Case and Benchmarks</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Charlene" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Reproducibility guide for Madeus Openstack Use Case and Benchmarks</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9c8a3bf">Introduction</a></li>
<li><a href="#orgaa78bab">Reproducibility</a>
<ul>
<li><a href="#orgd4f69f8">Openstack Deployment Graphs</a>
<ul>
<li><a href="#org1fc8910">Requirements</a></li>
<li><a href="#org344cbd8">Plotting the Gantt charts</a></li>
<li><a href="#org6852ae2">Plotting the performance comparison charts</a></li>
<li><a href="#org928f818">Recreating tables from the paper</a></li>
</ul>
</li>
<li><a href="#orgd592769">Benchmark Graphs</a>
<ul>
<li><a href="#org97b5ef8">Requirements</a></li>
<li><a href="#org64d9555">Plotting the curves</a></li>
</ul>
</li>
<li><a href="#orgffa70a5">Openstack CI logs</a>
<ul>
<li><a href="#orgb792873">Requirements</a></li>
<li><a href="#org7ae7302">Get the logs</a></li>
<li><a href="#org549c4cc">Plot the curve</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgef0f32e">Repeatability</a>
<ul>
<li><a href="#org326fb02">Open Stack Use Case</a>
<ul>
<li><a href="#orgfb3a677">Requirements</a></li>
<li><a href="#g5k">Grid5000 setup</a></li>
<li><a href="#org671e50e">Getting the code</a></li>
<li><a href="#orga06e794">Starting a virtual environment</a></li>
<li><a href="#orgd99a4f9">Install the requirements in the virtual environment</a></li>
<li><a href="#org44243a3">Machine Topology used in our experiments</a></li>
<li><a href="#orgb5edf90">Node setup</a></li>
<li><a href="#orgdd023e4">Mad Workflow</a></li>
<li><a href="#org8ba7483">Deploying Openstack on the Grid5000 nodes using kolla-ansible</a></li>
<li><a href="#org0cc4cba">Request the resources for the benchmarks</a></li>
<li><a href="#org28ed257">Launch the OpenStack benchmarks</a></li>
<li><a href="#org0c1aa4f">Behind the scenes</a></li>
<li><a href="#org0a60b3e">Recover the benchmark results</a></li>
<li><a href="#orgf29bb4c">Restoring a previous environment</a></li>
<li><a href="#orgea5623c">Plot the data from the benchmarks results</a></li>
</ul>
</li>
<li><a href="#orgb37f4a8">SSH Benchmarks</a>
<ul>
<li><a href="#org4ee1a5d">Requirements</a></li>
<li><a href="#org6eba3d3">Accessing a Grid5000 frontend</a></li>
<li><a href="#org9e46217">Getting the code</a></li>
<li><a href="#org725d292">Installing the requirements</a></li>
<li><a href="#org533a0cd">Launching the benchmarks</a></li>
<li><a href="#orgfc5561d">Recover the benchmark results</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org9c8a3bf" class="outline-2">
<h2 id="org9c8a3bf">Introduction</h2>
<div class="outline-text-2" id="text-org9c8a3bf">
<p>
This page aims to offer a practical way of reproducing the experiments presented in the paper [Enhancing Separation of Concerns and Parallelism Expressivity in Distributed Software Commissionning with Madeus].
Our experiments are based on the deployment of <a href="https://www.openstack.org/">OpenStack</a>, and SSH benchmarks.
This lab will allow the reproduction of the various graphs of the paper and the experiments themselves.
</p>
</div>
</div>

<div id="outline-container-orgaa78bab" class="outline-2">
<h2 id="orgaa78bab">Reproducibility</h2>
<div class="outline-text-2" id="text-orgaa78bab">
</div>
<div id="outline-container-orgd4f69f8" class="outline-3">
<h3 id="orgd4f69f8">Openstack Deployment Graphs</h3>
<div class="outline-text-3" id="text-orgd4f69f8">
</div>
<div id="outline-container-org1fc8910" class="outline-4">
<h4 id="org1fc8910">Requirements</h4>
<div class="outline-text-4" id="text-org1fc8910">
<p>
Python 3.7+ and git are required.
First, you need to recover the code on the <a href="https://gitlab.inria.fr/VeRDi-project/madeus-journal">Gitlab</a> repository.
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://gitlab.inria.fr/VeRDi-project/madeus-journal.git
</pre>
</div>
<p>
The results directories are also on the paper <a href="https://gitlab.inria.fr/VeRDi-project/madeus-journal">repository</a> in the <code>results</code> directory. There are two Open Stack deployment result directories,
<code>ecotype</code> and <code>nova</code>, named from the Grid'5000 clusters we used to run the experiments. The benchmark results are found in the <code>ssh_bench</code> directory.
</p>
</div>
</div>

<div id="outline-container-org344cbd8" class="outline-4">
<h4 id="org344cbd8">Plotting the Gantt charts</h4>
<div class="outline-text-4" id="text-org344cbd8">
<div class="org-src-container">
<pre class="src src-sh">python graph_os_results.py creategantt -f [filename] -n [name] -nb [number]
</pre>
</div>
<p>
This command takes in entry the resulting json file <b>[filename]</b> of the times resulting from one of our experiments and allows to draw the gantt curves
corresponding to it. It outputs a svg file as a result, with the <b>[name]</b> given in input and the <b>[number]</b> of files corresponding to the name (number of experiments).
</p>

<div class="figure">
<p><img src="./img/gantt_dag_nt4_remote.png" alt="gantt_dag_nt4_remote.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Gantt chart example for an experiment</p>
</div>

<p>
The gantt graph displays the deployment of the various transitions, with all transitions from the same component sharing the same colour.
For sequential assemblies, the transitions are ordered by starting order.
</p>
</div>
</div>
<div id="outline-container-org6852ae2" class="outline-4">
<h4 id="org6852ae2">Plotting the performance comparison charts</h4>
<div class="outline-text-4" id="text-org6852ae2">
<div class="org-src-container">
<pre class="src src-sh">python graph_os_results.py performcomparison -rp [result_path] -f [filename]
</pre>
</div>
<p>
This command takes in entry the path as <b>[result_path]</b> where the resulting json file from the experiments are and draw a performance comparison
between the different assemblies and the remote, local and cached version of their deployment. It outputs an svg file <b>[filename]</b> of this chart.
</p>

<div class="figure">
<p><img src="./img/perform_ecotype.png" alt="perform_ecotype.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Performance comparison example</p>
</div>
</div>
</div>
<div id="outline-container-org928f818" class="outline-4">
<h4 id="org928f818">Recreating tables from the paper</h4>
<div class="outline-text-4" id="text-org928f818">
</div>
<ul class="org-ul">
<li><a id="orga22ce95"></a>Pull transition times (Table 8 of the paper)<br />
<div class="outline-text-6" id="text-orga22ce95">
<div class="org-src-container">
<pre class="src src-sh">python3 graph_os_results.py tableofpulls -f [result_path] -n [nb_exp]
</pre>
</div>
<p>
This command allows the reproduction of our table describing the time taken by the pull transition relative to the total time of the commissionning.
It takes as input the <b>result_path</b> of the resulting transition times and a number <b>nb_exp</b> representing the number of experiment repetitions. 
This will provide the values that can be seen in table 8 in the paper as an output in the terminal.
</p>

<div class="figure">
<p><img src="./img/table_pull.png" alt="table_pull.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Table of pull times</p>
</div>
</div>
</li>

<li><a id="org1016070"></a>Commissioning times over various assemblies<br />
<div class="outline-text-6" id="text-org1016070">
<div class="org-src-container">
<pre class="src src-sh">python graph_os_results.py analyze -rp [result_path] -tn [table_name]
</pre>
</div>

<p>
This command reproduces the values in table 6 and 7 with the commissionning times for each experiment. 
The inputs required are the experiments <b>result_path</b> and a filename <b>table_name</b> for the resulting LaTeX code of the table.
</p>


<div class="figure">
<p><img src="./img/table_commissioning.png" alt="table_commissioning.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Table of commissionning times</p>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgd592769" class="outline-3">
<h3 id="orgd592769">Benchmark Graphs</h3>
<div class="outline-text-3" id="text-orgd592769">
</div>
<div id="outline-container-org97b5ef8" class="outline-4">
<h4 id="org97b5ef8">Requirements</h4>
<div class="outline-text-4" id="text-org97b5ef8">
<p>
For the benchmark result plotting we use also Python 3.7.
The requirements are the <a href="https://click.palletsprojects.com/en/7.x/">click</a> and <a href="https://matplotlib.org">matlplotlib</a> library.
</p>
</div>
</div>
<div id="outline-container-org64d9555" class="outline-4">
<h4 id="org64d9555">Plotting the curves</h4>
<div class="outline-text-4" id="text-org64d9555">
<p>
To plot our graphs, we used the resulting files that are in the <code>results/ssh_bench/raw</code> directory.
</p>

<p>
They are sorted by type of experiment, parallel or sequential.
</p>

<p>
To plot the graphs, we use the <code>graph_results_pyplot.py</code> file is in the <code>results/ssh_bench</code> directory of the journal's repository. 
The command <code>analyze</code> is used to create the graphs, and the options to give are the directory containing the dryrun results
<code>-drp [directory]</code>, and the type of experiment, whether sequential or parallel with <code>-exp [parallel|sequential]</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">python3 graph_results_pyplot.py analyze -drp raw/seq_no_ssh -exp sequential
</pre>
</div>


<div id="org5c637ca" class="figure">
<p><img src="./img/evaluations_sequential.png" alt="evaluations_sequential.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgffa70a5" class="outline-3">
<h3 id="orgffa70a5">Openstack CI logs</h3>
<div class="outline-text-3" id="text-orgffa70a5">
</div>
<div id="outline-container-orgb792873" class="outline-4">
<h4 id="orgb792873">Requirements</h4>
<div class="outline-text-4" id="text-orgb792873">
<p>
The script uses Python 3.7 and has its requirements listed in the requirements.txt file. 
Librairy used is <a href="https://2.python-requests.org/en/master/">requests</a>.
It can be installed by using pip:
</p>
<div class="org-src-container">
<pre class="src src-sh">pip3 install -r requirements.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-org7ae7302" class="outline-4">
<h4 id="org7ae7302">Get the logs</h4>
<div class="outline-text-4" id="text-org7ae7302">
<p>
To get the log simply go in the openstack_ci repository and launch the <b>openstack_ci_info.py</b> script.
</p>
<div class="org-src-container">
<pre class="src src-sh">python3 openstack_ci_info.py
</pre>
</div>
<p>
This will generate 7 subprocesses to recover all 7 days of logs archived on logstash.openstack.org, 
taking the kolla-ansible data and processing it to find which processes took more than 15 minutes to finish, 
which is a good sign that there has been a kolla-ansible deployment during this.
It saves up all the build_uuids in the results directory.
</p>
</div>
</div>
<div id="outline-container-org549c4cc" class="outline-4">
<h4 id="org549c4cc">Plot the curve</h4>
</div>
</div>
</div>
<div id="outline-container-orgef0f32e" class="outline-2">
<h2 id="orgef0f32e">Repeatability</h2>
<div class="outline-text-2" id="text-orgef0f32e">
</div>
<div id="outline-container-org326fb02" class="outline-3">
<h3 id="org326fb02">Open Stack Use Case</h3>
<div class="outline-text-3" id="text-org326fb02">
</div>
<div id="outline-container-orgfb3a677" class="outline-4">
<h4 id="orgfb3a677">Requirements</h4>
<div class="outline-text-4" id="text-orgfb3a677">
<p>
Here are the requirements for the Open Stack Use case to run:
</p>
<ul class="org-ul">
<li>python 3.7+</li>
<li>git</li>
</ul>

<p>
To launch the experiments on Grid 5000:
</p>
<ul class="org-ul">
<li>a Grid5000 account and to setting up your ssh config appropriately (see <a href="#g5k">Grid5000 setup</a>)</li>
</ul>

<p>
All other required librairies will be installed in a virtual environment and are contained in the <code>requirements.txt</code> file at the root directory of the lab.
The lab code can be found on <a href="https://gitlab.inria.fr/VeRDi-project/madeus-openstack-benchmarks">Gitlab</a>.
</p>
</div>
</div>

<div id="outline-container-org3ce1506" class="outline-4">
<h4 id="g5k"><a id="org3ce1506"></a>Grid5000 setup</h4>
<div class="outline-text-4" id="text-g5k">
<ul class="org-ul">
<li>You need to set the `~/.python-grid5000.yaml` file as explained <a href="https://discovery.gitlabpages.inria.fr/enoslib/tutorials/grid5000.html#configuration">here</a>.</li>
<li>An appropriate SSH configuration is required to access automatically
the distant nodes on G5K as `root` for the sake of the deployment process. By
default, the public key sent to the distant nodes is `~/.ssh/id_rsa.pub`. Be
sure this key exists.
(It is otherwise recommended to create a set of key specifically for
grid5000).</li>
</ul>

<p>
Next, be sure the file `~/.ssh/config` contains the following parts, adapted with your own Grid 5000 username:
</p>
<pre class="example">
# Ease the access to the global access machine
Host g5k
    User &lt;your_g5k_username&gt;
    Hostname access.grid5000.fr
    ForwardAgent yes

# Ease the access to site frontends (e.g. rennes.g5k)
Host *.g5k
    User &lt;your_g5k_username&gt;
    ProxyCommand ssh g5k -W "`basename %h .g5k`:%p"
    ForwardAgent yes

# Ease the access to deployed nodes (e.g. paravance-42-kavlan-4.rennes.grid5000.fr)
Host *.grid5000.fr
    User root
    ProxyCommand ssh -A &lt;your_g5k_username&gt;@194.254.60.33 -W "$(basename %h):%p"
    ForwardAgent yes
</pre>
</div>
</div>

<div id="outline-container-org671e50e" class="outline-4">
<h4 id="org671e50e">Getting the code</h4>
<div class="outline-text-4" id="text-org671e50e">
<p>
First step is recovering all the code from the public repository. It also includes the results we have obtained and used in the paper.
</p>
<div class="org-src-container">
<pre class="src src-sh" id="org3f6d414">git clone https://gitlab.inria.fr/VeRDi-project/madeus-openstack-benchmarks.git &amp;&amp; <span style="color: #f08080;">cd</span> madeus-openstack-benchmarks
</pre>
</div>
<p>
Because we use a submodule for the Madeus assemblies regarding openstack, you need to recover that code as well:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #f08080;">cd</span> madeus-openstack &amp;&amp; git submodule update --init
</pre>
</div>
<p>
This will clone the proper assembly code in the madeus-openstack directory. The original repository is visible at the <a href="https://gitlab.inria.fr/VeRDi-project/madeus-openstack">Madeus-openstack repository</a>.
</p>
</div>
</div>

<div id="outline-container-orga06e794" class="outline-4">
<h4 id="orga06e794">Starting a virtual environment</h4>
<div class="outline-text-4" id="text-orga06e794">
<p>
It is recommended to run experiments in a virtual environment to keep your python installation clean.
</p>
<div class="org-src-container">
<pre class="src src-sh">virtualenv -p python3 venv
<span style="color: #f08080;">source</span> venv/bin/activate
</pre>
</div>

<p>
If your Grid5000 ssh key has a passphrase, you can use 
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #f08080;">eval</span> <span style="color: #deb887;">"$(ssh-agent -s)"</span> &amp;&amp; ssh-add
</pre>
</div>
<p>
before starting the experiments to add the key to your ssh agent and not have to input the passphrase several times over the deployment.
</p>
</div>
</div>

<div id="outline-container-orgd99a4f9" class="outline-4">
<h4 id="orgd99a4f9">Install the requirements in the virtual environment</h4>
<div class="outline-text-4" id="text-orgd99a4f9">
<p>
The makefile allows for the installation of the requirements, you can use:
</p>
<div class="org-src-container">
<pre class="src src-sh">make install_deps
</pre>
</div>
<p>
to launch the installation of the various libraries we use for these experiments.
We use  <a href="https://discovery.gitlabpages.inria.fr/enoslib/">EnOSlib</a>, that allows to organize our experiment workflow and configure our Grid5000 setup.
We also use <a href="http://execo.gforge.inria.fr/doc/latest-stable/">Execo</a> for the benchmark launches with the various experiment scenarios.
We use <a href="https://github.com/plotly/orca">Orca</a> for the curve plotting. 
</p>
</div>
</div>
<div id="outline-container-org44243a3" class="outline-4">
<h4 id="org44243a3">Machine Topology used in our experiments</h4>
<div class="outline-text-4" id="text-org44243a3">
<p>
To makes these experiments we have used two different topologies depending on the use of a local registry for the openstack images or a shared / remote registry.
</p>
</div>
<ul class="org-ul">
<li><a id="orgbfb294b"></a>Topology with a local registry node<br />
<div class="outline-text-6" id="text-orgbfb294b">

<div class="figure">
<p><img src="img/topology_local_registry.png" alt="topology_local_registry.png" />
</p>
</div>
</div>
</li>

<li><a id="orgbec51b1"></a>Topology for remote or shared registry<br />
<div class="outline-text-6" id="text-orgbec51b1">

<div class="figure">
<p><img src="img/topology_remote_registry.png" alt="topology_remote_registry.png" />
</p>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgb5edf90" class="outline-4">
<h4 id="orgb5edf90">Node setup</h4>
<div class="outline-text-4" id="text-orgb5edf90">
<p>
The details of the machine reservation on grid5000 are set in the <code>reservation.yaml</code> file where they can be updated to fit specific needs.
</p>
<div class="org-src-container">
<pre class="src src-yaml" id="orgd893f7b"><span style="color: #7f7f7f;">---</span>
<span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">############################################### #</span>
<span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Grid'5000 reservation parameters                #</span>
<span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">############################################### #</span>

<span style="color: #4eee94;">g5k</span>:
  <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">reservation: "2018-03-12 19:00:01"</span>
  <span style="color: #4eee94;">walltime</span>: <span style="color: #deb887;">"04:00:00"</span>
  <span style="color: #4eee94;">job_name</span>: mad-openstack
  <span style="color: #4eee94;">env_name</span>: debian10-x64-nfs
  <span style="color: #7f7f7f;">#</span><span style="color: #7f7f7f;">key: "~/.ssh/id_grid5k.pub"</span>
  <span style="color: #4eee94;">resources</span>:
    <span style="color: #4eee94;">machines</span>:
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- mad-node
      <span style="color: #4eee94;">cluster</span>: paravance
      <span style="color: #4eee94;">node</span>: 1
      <span style="color: #4eee94;">primary_network</span>: int-net
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- disco/registry
      <span style="color: #4eee94;">cluster</span>: paravance
      <span style="color: #4eee94;">node</span>: 1
      <span style="color: #4eee94;">primary_network</span>: int-net
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- openstack
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- control
      <span style="color: #4eee94;">cluster</span>: paravance
      <span style="color: #4eee94;">node</span>: 1
      <span style="color: #4eee94;">primary_network</span>: int-net
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- openstack
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- compute
      <span style="color: #4eee94;">cluster</span>: paravance
      <span style="color: #4eee94;">node</span>: 1
      <span style="color: #4eee94;">primary_network</span>: int-net
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- openstack
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - network
      <span style="color: #4eee94;">node</span>: 1
      <span style="color: #4eee94;">cluster</span>: paravance
      <span style="color: #4eee94;">primary_network</span>: int-net
    <span style="color: #4eee94;">networks</span>:
      - <span style="color: #4eee94;">id</span>: int-net
      <span style="color: #4eee94;">roles</span>: 
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>- network_interface
      <span style="color: #4eee94;">type</span>: kavlan
      <span style="color: #4eee94;">site</span>: rennes
</pre>
</div>
<p>
This reservation requests five machines, all from the <b>paravance</b> cluster, and all on the same network that is defined as <b>int-net</b>  in the last part of this reservation section.
We defined specific roles for our machines:
</p>
<ul class="org-ul">
<li>The <b>mad-node</b> is the node responsible for launching the assemblies for the deployment of openstack on the <b>openstack</b> nodes</li>
<li>The <b>openstack</b> are the nodes where openstack will be deployed and in our experiment they each have one specific role (<b>compute</b>, <b>control</b> and <b>network</b>), according to openstack deployment usages</li>
<li>The <b>disco/registry</b> is the node that will hold the docker image repository, for the cases when the repository is local, as opposed to remote or cached.</li>
</ul>
</div>
</div>

<div id="outline-container-orgdd023e4" class="outline-4">
<h4 id="orgdd023e4">Mad Workflow</h4>
<div class="outline-text-4" id="text-orgdd023e4">
<p>
A typical experiment using Mad is the sequence of several phases:
</p>

<dl class="org-dl">
<dt>deploy</dt><dd>Mad will read the configuration file, get machines from the resource provider and will prepare the next phase</dd>
<dt>install-os</dt><dd>Mad will deploy OpenStack on the machines. This phase relies on Kolla deployment.</dd>
<dt>backup</dt><dd>Mad will backup metrics gathered, logs and configuration files from the experiment.</dd>
<dt>destroy</dt><dd>Mad will release the resources.</dd>
</dl>

<p>
The <code>README.md</code> file contains more information about the various commands available. This document focuses on offering an easier way to reproduce the experiments presented in the paper and will not go in details over the various options. The <code>python mad.py</code> command has a <code>--help</code> flag that gives out information over the commands available.
</p>
</div>
</div>
<div id="outline-container-org8ba7483" class="outline-4">
<h4 id="org8ba7483">Deploying Openstack on the Grid5000 nodes using kolla-ansible</h4>
<div class="outline-text-4" id="text-org8ba7483">
<p>
The mad tool features commands to launch a deployment of openstack on g5k nodes with the use of the <code>deploy</code>, and <code>install-os</code> commands.
</p>
<div class="org-src-container">
<pre class="src src-sh">python mad-enoslib.py deploy --provider g5k --registry
python mad-enoslib.py install-os
python mad-enoslib.py destroy--hard
</pre>
</div>
<p>
The <code>destroy--hard</code> command is there to clean up the nodes once the deployment has been done.
</p>
</div>
</div>
<div id="outline-container-org0cc4cba" class="outline-4">
<h4 id="org0cc4cba">Request the resources for the benchmarks</h4>
<div class="outline-text-4" id="text-org0cc4cba">
<div class="org-src-container">
<pre class="src src-sh">python mad-enoslib.py deploy -c reservation.yaml -p g5k --bootstrap
</pre>
</div>
<p>
where the <code>-c</code> option indicates our reservation file, <code>-p</code> indicates the requested provier, and the <code>--bootstrap</code> flag indicates that it will populate the inventory with the proper information about the machines reserved and transfer all necessary environment values and files to the different nodes.
This step will issue the reservation of the machines to the chosen Grid5000 cluster, and once the machines have been deployed it will populate all the required files for kolla in a directory that will be linked symbolically to the <b><b>current</b></b> directory. These configuration files are necessary for the OpenStack deployment. 
</p>
</div>
</div>

<div id="outline-container-org28ed257" class="outline-4">
<h4 id="org28ed257">Launch the OpenStack benchmarks</h4>
<div class="outline-text-4" id="text-org28ed257">
<p>
Once the nodes have been reserved, to reproduce the benchmarks, you can specify which test to run by inputing it in the command as for example:
</p>
<div class="org-src-container">
<pre class="src src-sh">python mad-enoslib.py bench -c reservation.yaml --provider g5k --test all
</pre>
</div>
<p>
launches the scenario defined in the <code>reservation.yaml</code> file as <code>all</code>.
</p>

<div class="org-src-container">
<pre class="src src-yaml" id="org5b8493d"><span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">############################################### #</span>
<span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Experiment Scenarios                            #</span>
<span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">############################################### #</span>

<span style="color: #4eee94;">all</span>:
    <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Here are defined the parameters related to the Execo bench engine:</span>
    <span style="color: #4eee94;">params</span>:
      <span style="color: #4eee94;">test_type</span>: [<span style="color: #deb887;">"m_ansible"</span>, <span style="color: #deb887;">"madeus"</span>, <span style="color: #deb887;">"m_aeolus"</span>, <span style="color: #deb887;">"m_sequential"</span>]
      <span style="color: #4eee94;">registry</span>: [<span style="color: #deb887;">"cached"</span>, <span style="color: #deb887;">"local"</span>, <span style="color: #deb887;">"remote"</span>]

    <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Here are defined global parameters for our benchmarks:</span>
    <span style="color: #4eee94;">iterations</span>: 10

<span style="color: #4eee94;">test</span>:
    <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Here are defined the parameters related to the Execo bench engine:</span>
    <span style="color: #4eee94;">params</span>:
      <span style="color: #4eee94;">test_type</span>: [<span style="color: #deb887;">"m_ansible"</span>, <span style="color: #deb887;">"m_aeolus"</span>, <span style="color: #deb887;">"madeus"</span>]
      <span style="color: #4eee94;">registry</span>: [<span style="color: #deb887;">"cached"</span>, <span style="color: #deb887;">"local"</span>, <span style="color: #deb887;">"remote"</span>]

    <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Here are defined global parameters for our benchmarks:</span>
    <span style="color: #4eee94;">iterations</span>: 1  

<span style="color: #4eee94;">single</span>:
    <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Here are defined the parameters related to the Execo bench engine:</span>
    <span style="color: #4eee94;">params</span>:
      <span style="color: #4eee94;">test_type</span>: [<span style="color: #deb887;">"madeus"</span>]
      <span style="color: #4eee94;">registry</span>: [<span style="color: #deb887;">"local"</span>]

    <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Here are defined global parameters for our benchmarks:</span>
    <span style="color: #4eee94;">iterations</span>: 1
</pre>
</div>
<p>
Each benchmark scenario is defined by a name such as <b>all</b>, <b>test</b>, or <b>single</b> in our file. 
Our parameters are the numbers of iterations for each test that we want to go through and the list of the different assemblies we want to try (such as <b>seq_1t</b>, <b>dag_2t</b>, <b>dag_nt4</b>).
The <code>-p</code> and <code>-c</code> options are similar to the launch of the reservation. The <code>--test</code> option defines which tests will be launched from the different scenarios described in the <b><b>reservation.yaml</b></b> file.
It is posible to define other scenarios following the examples already present in the <b><b>reservation.yaml</b></b> file.
</p>
</div>
</div>

<div id="outline-container-org0c1aa4f" class="outline-4">
<h4 id="org0c1aa4f">Behind the scenes</h4>
<div class="outline-text-4" id="text-org0c1aa4f">
<p>
The call to <code>python mad.py bench</code> will run a tmux session named mad on the remote node with the <b><b>concerto-node</b></b> role that can be accessed through 
<code>ssh [concerto-node-adress]</code>
and 
</p>
<div class="org-src-container">
<pre class="src src-sh">tmux attach -t mad
</pre>
</div>
<p>
to observe the deployment process from the nodes.
</p>
</div>
</div>

<div id="outline-container-org0a60b3e" class="outline-4">
<h4 id="org0a60b3e">Recover the benchmark results</h4>
<div class="outline-text-4" id="text-org0a60b3e">
<p>
To recover the results from the previously launched benchmarks, just run the following command:
</p>
<div class="org-src-container">
<pre class="src src-sh">python mad-enoslib.py backup 
</pre>
</div>
<p>
The backup command allows to recover the environment configuration from the experiment and the resulting files that are on the concerto node, such as the kolla logs and the madeus directory.
The resulting files are in the <code>backups</code> directory, under the timestamp of the experiment start.
</p>

<p>
The backup command can also be used to save an environment and benchmark configuration if the reservation is reaching its limits.
</p>
</div>
</div>
<div id="outline-container-orgf29bb4c" class="outline-4">
<h4 id="orgf29bb4c">Restoring a previous environment</h4>
<div class="outline-text-4" id="text-orgf29bb4c">
<p>
The <b>restore</b> option of deploy allows to restore the environment configuration and to restart the benchmark from where it was stopped
</p>
<div class="org-src-container">
<pre class="src src-sh">python mad-enoslib.py deploy -c reservation.yaml -b --restore backup_dir
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea5623c" class="outline-4">
<h4 id="orgea5623c">Plot the data from the benchmarks results</h4>
<div class="outline-text-4" id="text-orgea5623c">
<p>
Once the resulting files have been recovered through the <b><b>backup</b></b> command, the use of <b><b>analyze</b></b> will allow for the creation of time charts, by replacing <code>Timestamp</code> by the timestamp of the experiment that is the name of the backup directory just created.
</p>
<div class="org-src-container">
<pre class="src src-sh">python mad-enoslib.py analyze -b backups/Timestamp
</pre>
</div>
<p>
This will go through the results and plot the charts of the experiment times.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb37f4a8" class="outline-3">
<h3 id="orgb37f4a8">SSH Benchmarks</h3>
<div class="outline-text-3" id="text-orgb37f4a8">
</div>
<div id="outline-container-org4ee1a5d" class="outline-4">
<h4 id="org4ee1a5d">Requirements</h4>
<div class="outline-text-4" id="text-org4ee1a5d">
<p>
Here are the requirements for the SSH benchmarks:
</p>
<ul class="org-ul">
<li>a Grid5000 account and a proper set up as described in <a href="#g5k">Grid5000 Setup</a></li>
</ul>
</div>
</div>
<div id="outline-container-org6eba3d3" class="outline-4">
<h4 id="org6eba3d3">Accessing a Grid5000 frontend</h4>
<div class="outline-text-4" id="text-org6eba3d3">
<p>
These benchmarks will be launched from a Grid5000 frontend:
</p>
<div class="org-src-container">
<pre class="src src-sh">ssh access.grid5000.fr
</pre>
</div>
<p>
In our configuration we make reservations on the nantes site, so we will access the nantes frontend:
</p>
<pre class="example">
ssh nantes
</pre>
<p>
If your Grid5000 configuration is properly setup, you should now have a shell starting with <code>[your_g5k_login@fnantes]</code>.
</p>
</div>
</div>
<div id="outline-container-org9e46217" class="outline-4">
<h4 id="org9e46217">Getting the code</h4>
<div class="outline-text-4" id="text-org9e46217">
<p>
The SSH benchmarks code is contained in the journal repository:
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://gitlab.inria.fr/VeRDi-project/madeus-journal.git
</pre>
</div>
<p>
To launch the benchmarks, you need to have <b>concerto</b> also, that you can as before, get from the gitlab repository
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://gitlab.inria.fr/VeRDi-project/concerto.git
</pre>
</div>
</div>
</div>
<div id="outline-container-org725d292" class="outline-4">
<h4 id="org725d292">Installing the requirements</h4>
<div class="outline-text-4" id="text-org725d292">
<p>
We use  <a href="https://discovery.gitlabpages.inria.fr/enoslib/">EnOSlib</a> to set up the machine reservations on grid5000 and launch the experiments
</p>
<div class="org-src-container">
<pre class="src src-sh">pip3 install enoslib
</pre>
</div>
<p>
The concerto directory needs to be added to the python path:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #f08080;">cd</span> ~/concerto &amp;&amp; <span style="color: #f08080;">source</span> source_dir.sh
</pre>
</div>
</div>
</div>
<div id="outline-container-org533a0cd" class="outline-4">
<h4 id="org533a0cd">Launching the benchmarks</h4>
<div class="outline-text-4" id="text-org533a0cd">
</div>
<ul class="org-ul">
<li><a id="orgdb62fc8"></a>Sequential tests<br />
<div class="outline-text-5" id="text-orgdb62fc8">
<p>
The sequential tests are defined in the <code>reserve_and_test.py</code> file in the <code>tests/sequential_test/</code> directory. 
The configuration is in the conf.yaml file of the directory. 
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #4eee94;">g5k</span>:
  <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">reservation: "2018-03-12 19:00:01"                                                                                                                                                                                                 </span>
  <span style="color: #4eee94;">walltime</span>: <span style="color: #deb887;">"01:00:00"</span>
  <span style="color: #4eee94;">dhcp</span>: <span style="color: #a2cd5a;">true</span>
  <span style="color: #4eee94;">job_name</span>: concerto_ssh_scalability
  <span style="color: #4eee94;">env_name</span>: debian10-x64-base
  <span style="color: #4eee94;">resources</span>:
    <span style="color: #4eee94;">machines</span>:
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - concerto
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">cluster</span>: ecotype
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">nodes</span>: 1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">primary_network</span>: n1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">secondary_networks</span>: []
    <span style="color: #4eee94;">networks</span>:
      - <span style="color: #4eee94;">id</span>: n1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - control_network
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - database_network
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">type</span>: prod
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">site</span>: nantes
</pre>
</div>
<p>
If your want to test on other sites or with other clusters you can change the values in this file to that purpose.
</p>
</div>
<ul class="org-ul">
<li><a id="customdir"></a><a id="org9a708e4"></a>Resulting directory<br />
<div class="outline-text-6" id="text-customdir">
<p>
The results are saved in a directory that is defined by default as `exp` but can be changed by modifying the 
`reserve_and_test.py` file, replacing the main l.50 by this:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #00bfff;">if</span> <span style="color: #f08080;">__name__</span> == <span style="color: #deb887;">'__main__'</span>:
    logging.basicConfig(level=logging.DEBUG)
    perform_experiment(
        list_chain_length=[1, 5, 25, 100],
        working_directory=<span style="color: #deb887;">'directory_name'</span>,
        nb_repeats=5
    )
</pre>
</div>
<p>
To launch the experiments for sequential ssh test you can use the following command:
</p>
<div class="org-src-container">
<pre class="src src-sh">python3 benchmarks/sequential_test/reserve_and_test.py
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org5a666b0"></a>Parallel tests<br />
<div class="outline-text-5" id="text-org5a666b0">
<p>
The parallel tests are defined in the <code>reserve_and_test.py</code> file in the <code>test/sequential_test/</code> directory.
The configuration is in the conf.yaml file of the directory
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #4eee94;">g5k</span>:
  <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">reservation: "2018-03-12 19:00:01"</span>
  <span style="color: #4eee94;">walltime</span>: <span style="color: #deb887;">"01:00:00"</span>
  <span style="color: #4eee94;">dhcp</span>: <span style="color: #a2cd5a;">true</span>
  <span style="color: #4eee94;">job_name</span>: concerto_ssh_scalability
  <span style="color: #4eee94;">env_name</span>: debian10-x64-base
  <span style="color: #4eee94;">resources</span>:
    <span style="color: #4eee94;">machines</span>:
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - remote
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">cluster</span>: ecotype
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">nodes</span>: 10  <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">will be changed by reserve_and_test</span>
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">primary_network</span>: n1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">secondary_networks</span>: []
      - <span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - concerto
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">cluster</span>: ecotype
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">nodes</span>: 1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">primary_network</span>: n1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">secondary_networks</span>: []
    <span style="color: #4eee94;">networks</span>:
      - <span style="color: #4eee94;">id</span>: n1
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">roles</span>:
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - control_network
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span>  - database_network
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">type</span>: prod
<span style="color: #ff0000; background-color: #ff0000; font-weight: bold;">        </span><span style="color: #4eee94;">site</span>: nantes
</pre>
</div>
<p>
The results are saved by default in two directory, `exp_ssh` for the run with ssh experiment 
and `exp_no_ssh`  for the dry run experiment. These directories can be changed in the `reserve_and_test.py`
file, by changing the main l.71 and l.79:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #00bfff;">if</span> <span style="color: #f08080;">__name__</span> == <span style="color: #deb887;">'__main__'</span>:
    logging.basicConfig(level=logging.DEBUG)
    perform_experiment(
        list_nb_components=[1, 5, 10, 15, 20],
        list_nb_parallel_transitions=[1, 5, 10, 20],
        sleep_time=10,
        nb_repeats=5,
        working_directory=<span style="color: #deb887;">"exp_ssh"</span>,
        ssh_test=<span style="color: #a2cd5a;">True</span>
    )
    perform_experiment(
        list_nb_components=[1, 5, 10, 15, 20, 50],
        list_nb_parallel_transitions=[1, 5, 10, 20],
        sleep_time=1,
        nb_repeats=5,
        working_directory=<span style="color: #deb887;">"exp_no_ssh"</span>,
        ssh_test=<span style="color: #a2cd5a;">False</span>
    )
</pre>
</div>
<p>
You can change the directory here should you want to.
</p>
<div class="org-src-container">
<pre class="src src-sh">python3 benchmarks/parallel_test/reserve_and_test.py
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgfc5561d" class="outline-4">
<h4 id="orgfc5561d">Recover the benchmark results</h4>
<div class="outline-text-4" id="text-orgfc5561d">
<p>
Once the benchmarks are done, the results are in the directories previously presented in <a href="#customdir">Launching the benchmarks</a>.
You can make an archive out of the results, for example from the `exp` directory.
</p>
<div class="org-src-container">
<pre class="src src-sh">tar -czvf results.tar.gz exp
</pre>
</div>
<p>
To recover your archive, you can then either use your public access (through identification) of Grid'5000 to download it:
</p>
<div class="org-src-container">
<pre class="src src-sh">mv results.tar.gz ~/public
</pre>
</div>
<p>
which will allow you to access the archive on <code>https://api.grid5000.fr/sid/sites/[siteUsed]/public/[grid5000Login]/</code>.
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Charlene</p>
<p class="date">Created: 2020-02-24 lun. 14:06</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
